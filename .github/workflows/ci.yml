name: Universal CI

on:
  push:
    branches: [ main, dev ]
  pull_request:

jobs:
  test-matrix:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        language: [c, cpp, csharp, python, ruby, go, rust, java, kotlin, dart, lua, perl, php, r, swift, typescript, fsharp]
    
    steps:
    - uses: actions/checkout@v4

    - name: ğŸ”§ Universal Setup
      run: chmod +x strling

    - name: ğŸ“¦ Install Dependencies (Setup)
      run: ./strling setup ${{ matrix.language }}
      continue-on-error: false

    - name: ğŸ”¨ Compile (Build)
      # Only runs if the language HAS a build step in toolchain.json
      run: ./strling build ${{ matrix.language }} || echo "No build step required"

    - name: ğŸ§ª Execute Tests
      run: ./strling test ${{ matrix.language }}
